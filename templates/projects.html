{% extends "base.html" %}

{% block content %}
<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="fw-bold text-glow">–ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç</h1>
        <p class="text-muted">–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–æ–≤</p>
    </div>
    {% if current_user.is_authenticated and current_user.is_client %}
        <a href="{{ url_for('create_project') }}" class="btn btn-primary glow">
            <i class="bi bi-plus-circle me-2"></i>–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
        </a>
    {% endif %}
</div>

<!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
<div class="card mb-4 border-primary">
    <div class="card-body">
        <form method="GET" class="row g-3 align-items-end">
            <div class="col-md-5">
                <label class="form-label fw-bold">–ü–æ–∏—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤</label>
                <div class="input-group">
                    <span class="input-group-text bg-dark border-end-0">
                        <i class="bi bi-search"></i>
                    </span>
                    <input type="text" class="form-control border-start-0" name="search"
                           placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞, –æ–ø–∏—Å–∞–Ω–∏–µ..." value="{{ request.args.get('search', '') }}">
                </div>
            </div>

            <div class="col-md-4">
                <label class="form-label fw-bold">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select class="form-select" name="category">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    <option value="–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞" {% if request.args.get('category') == '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞' %}selected{% endif %}>üíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞</option>
                    <option value="–î–∏–∑–∞–π–Ω" {% if request.args.get('category') == '–î–∏–∑–∞–π–Ω' %}selected{% endif %}>üé® –î–∏–∑–∞–π–Ω</option>
                    <option value="–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥" {% if request.args.get('category') == '–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥' %}selected{% endif %}>üìà –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</option>
                    <option value="–¢–µ–∫—Å—Ç—ã" {% if request.args.get('category') == '–¢–µ–∫—Å—Ç—ã' %}selected{% endif %}>‚úçÔ∏è –¢–µ–∫—Å—Ç—ã</option>
                    <option value="–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è" {% if request.args.get('category') == '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è' %}selected{% endif %}>üí¨ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</option>
                </select>
            </div>

            <!-- –§–∏–ª—å—Ç—Ä—ã —Å—Ç–∞—Ç—É—Å–∞ -->
            <div class="btn-group mb-4">
                <a href="{{ url_for('projects', status='open') }}"
                   class="btn btn-outline-primary {% if status_filter == 'open' %}active{% endif %}">
                    üîì –û—Ç–∫—Ä—ã—Ç—ã–µ
                </a>
                <a href="{{ url_for('projects', status='in_progress') }}"
                   class="btn btn-outline-warning {% if status_filter == 'in_progress' %}active{% endif %}">
                    üîÑ –í —Ä–∞–±–æ—Ç–µ
                </a>
                <a href="{{ url_for('projects', status='completed') }}"
                   class="btn btn-outline-secondary {% if status_filter == 'completed' %}active{% endif %}">
                    ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
                </a>
            </div>

            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
            <div class="col-md-3">
                <label class="form-label fw-bold">–ë—é–¥–∂–µ—Ç</label>
                <select class="form-select" name="budget_filter">
                    <option value="">–õ—é–±–æ–π –±—é–¥–∂–µ—Ç</option>
                    <option value="0-5000">–¥–æ 5,000 ‚ÇΩ</option>
                    <option value="5000-20000">5,000 - 20,000 ‚ÇΩ</option>
                    <option value="20000+">–æ—Ç 20,000 ‚ÇΩ</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                <select class="form-select" name="sort">
                    <option value="newest">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                    <option value="budget_high">–ü–æ —É–±—ã–≤–∞–Ω–∏—é –±—é–¥–∂–µ—Ç–∞</option>
                    <option value="budget_low">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –±—é–¥–∂–µ—Ç–∞</option>
                </select>
            </div>

            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100 glow">
                    <i class="bi bi-funnel me-2"></i>–ù–∞–π—Ç–∏
                </button>
            </div>
        </form>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞ -->
<div class="d-flex justify-content-between align-items-center mb-3">
    <span class="text-muted code-font">
        –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–µ–∫—Ç–æ–≤: <strong class="text-info">{{ projects|length }}</strong>
        {% if status_filter == 'open' %}(–æ—Ç–∫—Ä—ã—Ç—ã—Ö)
        {% elif status_filter == 'in_progress' %}(–≤ —Ä–∞–±–æ—Ç–µ)
        {% elif status_filter == 'completed' %}(–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö)
        {% endif %}
    </span>
    <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            <i class="bi bi-sort-down me-2"></i>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
        </button>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">–ü–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ)</a></li>
            <li><a class="dropdown-item" href="#">–ü–æ –±—é–¥–∂–µ—Ç—É (–≤—ã—Å–æ–∫–∏–π)</a></li>
            <li><a class="dropdown-item" href="#">–ü–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏</a></li>
        </ul>
    </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
{% if projects %}
    <div class="row">
        {% for project in projects %}
        <div class="col-xl-4 col-lg-6 mb-4">
            <div class="card project-card h-100">
                <div class="card-body d-flex flex-column">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –±—é–¥–∂–µ—Ç -->
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <span class="badge bg-primary">
                            {{ project.category }}
                        </span>
                        <div class="text-end">
                            <div class="h5 text-success mb-0 text-glow">{{ project.budget }} ‚ÇΩ</div>
                            <small class="text-muted">–±—é–¥–∂–µ—Ç</small>
                        </div>
                    </div>

                    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ -->
                    <h5 class="card-title text-glow">{{ project.title }}</h5>
                    <p class="card-text text-muted flex-grow-1">
                        {{ project.description[:150] }}{% if project.description|length > 150 %}...{% endif %}
                    </p>

                    <!-- –ù–∞–≤—ã–∫–∏ -->
                    {% if project.skills_required %}
                    <div class="mb-3">
                        <small class="text-muted fw-bold code-font">–¢—Ä–µ–±—É—é—Ç—Å—è:</small>
                        <div class="d-flex flex-wrap gap-1 mt-1">
                            {% for skill in project.skills_required.split(',')[:3] %}
                                <span class="badge bg-dark text-light border code-font">
                                    <i class="bi bi-tag me-1"></i>{{ skill.strip() }}
                                </span>
                            {% endfor %}
                            {% if project.skills_required.split(',')|length > 3 %}
                                <span class="badge bg-dark text-light border code-font">
                                    +{{ project.skills_required.split(',')|length - 3 }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- –§—É—Ç–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                    <div class="d-flex justify-content-between align-items-center mt-auto pt-3 border-top">
                        <div class="d-flex align-items-center">
                            <div class="user-avatar me-2" style="width: 35px; height: 35px; font-size: 0.9rem;">
                                {{ project.client.username[0] }}
                            </div>
                            <div>
                                <small class="d-block fw-bold code-font">{{ project.client.username }}</small>
                                <small class="text-muted">
                                    <i class="bi bi-clock me-1"></i>{{ project.created_at.strftime('%d.%m.%Y') }}
                                </small>
                            </div>
                        </div>
                        <a href="{{ url_for('project_detail', project_id=project.id) }}" class="btn btn-primary btn-sm">
                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <!-- –ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
    <div class="text-center py-5">
        <div class="mb-4">
            <i class="bi bi-inbox display-1 text-muted"></i>
        </div>
        <h3 class="text-muted">–ü—Ä–æ–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
        <p class="text-muted mb-4">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç</p>
        {% if current_user.is_authenticated and current_user.is_client %}
            <a href="{{ url_for('create_project') }}" class="btn btn-primary glow">
                <i class="bi bi-plus-circle me-2"></i>–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç
            </a>
        {% endif %}
    </div>
{% endif %}

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
{% if projects|length > 6 %}
<nav aria-label="Page navigation" class="mt-5">
    <ul class="pagination justify-content-center">
        <li class="page-item disabled">
            <a class="page-link bg-dark border-dark text-muted" href="#">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
        </li>
        <li class="page-item active"><a class="page-link bg-primary border-primary" href="#">1</a></li>
        <li class="page-item"><a class="page-link bg-dark border-dark text-muted" href="#">2</a></li>
        <li class="page-item"><a class="page-link bg-dark border-dark text-muted" href="#">3</a></li>
        <li class="page-item">
            <a class="page-link bg-dark border-dark text-muted" href="#">–°–ª–µ–¥—É—é—â–∞—è</a>
        </li>
    </ul>
</nav>
{% endif %}

<style>
.btn-group .btn.active {
    background: var(--accent-primary);
    border-color: var(--accent-primary);
    color: white;
}

.page-link {
    background: var(--bg-card);
    border-color: var(--border-color);
    color: var(--text-primary);
}

.page-link:hover {
    background: var(--bg-hover);
    border-color: var(--accent-primary);
}

.page-item.active .page-link {
    background: var(--accent-primary);
    border-color: var(--accent-primary);
}
</style>
{% endblock %}
