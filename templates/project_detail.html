{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="col-lg-8">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <span class="badge bg-{% if project.status == 'open' %}success{% else %}secondary{% endif %} me-2 fs-6">
                            {{ 'üîì –û—Ç–∫—Ä—ã—Ç' if project.status == 'open' else 'üîí –ó–∞–∫—Ä—ã—Ç' }}
                        </span>
                        <span class="badge bg-primary fs-6">{{ project.category }}</span>
                    </div>
                    <div class="text-end">
                        <h2 class="text-success mb-0">{{ project.budget }} ‚ÇΩ</h2>
                        <small class="text-muted">–ë—é–¥–∂–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞</small>
                    </div>
                </div>

                <h1 class="fw-bold mb-4">{{ project.title }}</h1>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑—á–∏–∫–µ -->
                <div class="d-flex align-items-center mb-4 p-3 bg-light rounded">
                    <div class="user-avatar me-3">
                        {{ project.client.username[0] }}
                    </div>
                    <div>
                        <h6 class="fw-bold mb-1">{{ project.client.username }}</h6>
                        <small class="text-muted">
                            <i class="bi bi-calendar me-1"></i>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω {{ project.created_at.strftime('%d.%m.%Y –≤ %H:%M') }}
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ -->
        <div class="card mb-4">
            <div class="card-body">
                <h4 class="fw-bold mb-4">
                    <i class="bi bi-file-text text-primary me-2"></i>–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
                </h4>
                <div class="project-description">
                    {{ project.description|replace('\n', '<br>')|safe }}
                </div>
            </div>
        </div>

        <!-- –¢—Ä–µ–±—É–µ–º—ã–µ –Ω–∞–≤—ã–∫–∏ -->
        {% if project.skills_required %}
        <div class="card mb-4">
            <div class="card-body">
                <h4 class="fw-bold mb-4">
                    <i class="bi bi-tools text-primary me-2"></i>–¢—Ä–µ–±—É–µ–º—ã–µ –Ω–∞–≤—ã–∫–∏
                </h4>
                <div class="d-flex flex-wrap gap-2">
                    {% for skill in project.skills_required.split(',') %}
                        <span class="badge bg-primary px-3 py-2 fs-6">
                            <i class="bi bi-check-circle me-1"></i>{{ skill.strip() }}
                        </span>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="col-lg-4">
        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="fw-bold mb-3">–î–µ–π—Å—Ç–≤–∏—è</h5>

                {% if current_user.is_authenticated %}
                    {% if not current_user.is_client and project.status == 'open' %}
                        <form method="POST" action="{{ url_for('respond_to_project', project_id=project.id) }}">
                            <button type="submit" class="btn btn-primary w-100 mb-2 py-2">
                                <i class="bi bi-envelope me-2"></i>üì® –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–µ–∫—Ç
                            </button>
                        </form>
                        <small class="text-muted d-block text-center mb-3">
                            –ü–æ—Å–ª–µ –æ—Ç–∫–ª–∏–∫–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —á–∞—Ç —Å –∑–∞–∫–∞–∑—á–∏–∫–æ–º
                        </small>
                    {% endif %}

                    {% if current_user.id == project.client_id %}
                        <button class="btn btn-outline-primary w-100 mb-2" onclick="alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
                            <i class="bi bi-pencil me-2"></i>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
                        </button>
                        <button class="btn btn-outline-danger w-100" onclick="alert('–ó–∞–∫—Ä—ã—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
                            <i class="bi bi-lock me-2"></i>üîí –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç
                        </button>
                    {% endif %}
                {% else %}
                    <div class="text-center">
                        <p class="text-muted mb-3">–í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã –æ—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–µ–∫—Ç</p>
                        <a href="{{ url_for('login') }}" class="btn btn-primary w-100 mb-2">
                            <i class="bi bi-box-arrow-in-right me-2"></i>–í–æ–π—Ç–∏
                        </a>
                        <a href="{{ url_for('register') }}" class="btn btn-outline-primary w-100">
                            <i class="bi bi-person-plus me-2"></i>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="fw-bold mb-3">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ</h5>

                <div class="info-item mb-3">
                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                        <span class="text-muted">–°—Ç–∞—Ç—É—Å:</span>
                        <span class="badge bg-{% if project.status == 'open' %}success{% else %}secondary{% endif %}">
                            {{ '–û—Ç–∫—Ä—ã—Ç' if project.status == 'open' else '–ó–∞–∫—Ä—ã—Ç' }}
                        </span>
                    </div>
                </div>

                <div class="info-item mb-3">
                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                        <span class="text-muted">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
                        <strong>{{ project.category }}</strong>
                    </div>
                </div>

                <div class="info-item mb-3">
                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                        <span class="text-muted">–ë—é–¥–∂–µ—Ç:</span>
                        <strong class="text-success">{{ project.budget }} ‚ÇΩ</strong>
                    </div>
                </div>

                <div class="info-item">
                    <div class="d-flex justify-content-between align-items-center py-2">
                        <span class="text-muted">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω:</span>
                        <strong>{{ project.created_at.strftime('%d.%m.%Y') }}</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ó–∞–∫–∞–∑—á–∏–∫ -->
        <div class="card">
            <div class="card-body">
                <h5 class="fw-bold mb-3">–ó–∞–∫–∞–∑—á–∏–∫</h5>
                <div class="d-flex align-items-center mb-3">
                    <div class="user-avatar me-3">
                        {{ project.client.username[0] }}
                    </div>
                    <div>
                        <h6 class="fw-bold mb-1">{{ project.client.username }}</h6>
                        <small class="text-muted">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω {{ project.client.created_at.strftime('%d.%m.%Y') }}</small>
                    </div>
                </div>
                {% if project.client.profile %}
                <div class="mt-3">
                    <small class="text-muted">–û –∑–∞–∫–∞–∑—á–∏–∫–µ:</small>
                    <p class="small mb-0">{{ project.client.profile.description[:100] }}{% if project.client.profile.description|length > 100 %}...{% endif %}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.project-description {
    line-height: 1.6;
    font-size: 1.1rem;
}

.project-description br {
    margin-bottom: 1rem;
    display: block;
}

.info-item {
    transition: background-color 0.2s;
}

.info-item:hover {
    background-color: rgba(0,0,0,0.02);
    border-radius: 5px;
    margin-left: -5px;
    margin-right: -5px;
    padding-left: 5px;
    padding-right: 5px;
}
</style>
{% endblock %}