{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card border-primary">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold mb-0 text-glow">
                        <i class="bi bi-headset text-primary me-2"></i>–¶–µ–Ω—Ç—Ä –ø–æ–¥–¥–µ—Ä–∂–∫–∏
                    </h2>
                    <a href="{{ url_for('create_support_ticket') }}" class="btn btn-primary glow">
                        <i class="bi bi-plus-circle me-2"></i>–ù–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ
                    </a>
                </div>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                <div class="row mb-5">
                    <div class="col-md-4 mb-3">
                        <div class="card text-center h-100 bg-dark">
                            <div class="card-body">
                                <div class="feature-icon mx-auto mb-3" style="width: 50px; height: 50px;">
                                    <i class="bi bi-question-circle"></i>
                                </div>
                                <h6 class="code-font">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h6>
                                <p class="text-muted small code-font">–û—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</p>
                                <button class="btn btn-outline-primary btn-sm" onclick="showKnowledgeBase()">–û—Ç–∫—Ä—ã—Ç—å</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card text-center h-100 bg-dark">
                            <div class="card-body">
                                <div class="feature-icon mx-auto mb-3" style="width: 50px; height: 50px; background: var(--success);">
                                    <i class="bi bi-chat-dots"></i>
                                </div>
                                <h6 class="code-font">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</h6>
                                <p class="text-muted small code-font">–ù–∞–ø–∏—à–∏—Ç–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É</p>
                                <a href="{{ url_for('create_support_ticket') }}" class="btn btn-outline-success btn-sm">–ù–∞–ø–∏—Å–∞—Ç—å</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card text-center h-100 bg-dark">
                            <div class="card-body">
                                <div class="feature-icon mx-auto mb-3" style="width: 50px; height: 50px; background: var(--warning);">
                                    <i class="bi bi-flag"></i>
                                </div>
                                <h6 class="code-font">–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</h6>
                                <p class="text-muted small code-font">–°–æ–æ–±—â–∏—Ç—å –æ –Ω–∞—Ä—É—à–µ–Ω–∏–∏</p>
                                <button class="btn btn-outline-warning btn-sm" onclick="showReportForm()">–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è -->
                <div>
                    <h5 class="fw-bold mb-3 text-glow">–ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è</h5>

                    {% if tickets %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th class="code-font">–¢–µ–º–∞</th>
                                    <th class="code-font">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                    <th class="code-font">–°—Ç–∞—Ç—É—Å</th>
                                    <th class="code-font">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                                    <th class="code-font">–î–∞—Ç–∞</th>
                                    <th class="code-font">–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ticket in tickets %}
                                <tr>
                                    <td>
                                        <a href="{{ url_for('support_ticket', ticket_id=ticket.id) }}" class="text-decoration-none text-glow">
                                            {{ ticket.subject }}
                                        </a>
                                    </td>
                                    <td class="code-font">{{ ticket.category }}</td>
                                    <td>
                                        <span class="badge bg-{% if ticket.status == 'open' %}warning{% elif ticket.status == 'in_progress' %}info{% elif ticket.status == 'resolved' %}success{% else %}secondary{% endif %} code-font">
                                            {% if ticket.status == 'open' %}–û—Ç–∫—Ä—ã—Ç
                                            {% elif ticket.status == 'in_progress' %}–í —Ä–∞–±–æ—Ç–µ
                                            {% elif ticket.status == 'resolved' %}–†–µ—à–µ–Ω
                                            {% else %}–ó–∞–∫—Ä—ã—Ç{% endif %}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-{% if ticket.priority == 'low' %}success{% elif ticket.priority == 'medium' %}warning{% elif ticket.priority == 'high' %}danger{% else %}dark{% endif %} code-font">
                                            {{ ticket.priority }}
                                        </span>
                                    </td>
                                    <td class="text-muted code-font">{{ ticket.created_at.strftime('%d.%m.%Y') }}</td>
                                    <td>
                                        <a href="{{ url_for('support_ticket', ticket_id=ticket.id) }}" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-5 text-muted">
                        <i class="bi bi-inbox display-4 mb-3"></i>
                        <h5>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π</h5>
                        <p class="mb-4 code-font">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –µ—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã</p>
                        <a href="{{ url_for('create_support_ticket') }}" class="btn btn-primary glow">
                            <i class="bi bi-plus-circle me-2"></i>–°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="col-lg-4">
        <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="fw-bold mb-3 text-glow">–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏</h5>
                <div class="mb-3">
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-envelope text-primary me-2"></i>
                        <span class="code-font">support@freelancehub.ru</span>
                    </div>
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-telegram text-info me-2"></i>
                        <span class="code-font">@freelancehub_support</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-clock text-warning me-2"></i>
                        <span class="code-font">–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ, 7 –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="card">
            <div class="card-body">
                <h5 class="fw-bold mb-3 text-glow">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π</h5>
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="code-font">–í—Å–µ–≥–æ:</span>
                        <strong class="text-info code-font">{{ tickets|length }}</strong>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="code-font">–û—Ç–∫—Ä—ã—Ç—ã–µ:</span>
                        <strong class="text-warning code-font">{{ tickets|selectattr('status', 'equalto', 'open')|list|length }}</strong>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="code-font">–í —Ä–∞–±–æ—Ç–µ:</span>
                        <strong class="text-info code-font">{{ tickets|selectattr('status', 'equalto', 'in_progress')|list|length }}</strong>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="code-font">–†–µ—à–µ–Ω–æ:</span>
                        <strong class="text-success code-font">{{ tickets|selectattr('status', 'equalto', 'resolved')|list|length }}</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showKnowledgeBase() {
    alert('üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
}

function showReportForm() {
    window.location.href = "{{ url_for('create_support_ticket') }}";
}
</script>

<style>
.card.bg-dark {
    background: var(--bg-card) !important;
    border: 1px solid var(--border-color);
}

.feature-icon {
    transition: transform 0.3s ease;
}

.card:hover .feature-icon {
    transform: scale(1.1);
}
</style>
{% endblock %}
